<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for modules/persistence.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">modules/</a> persistence.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">90% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>108/120</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">85% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>68/80</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/0</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.73% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>78/79</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict'
/**
 * Data persistence module.
 * @module Persistence
 */
&nbsp;
const schema = require('../schema/test-schema')
&nbsp;
/**
 * Creates a new entry in database for new user
 * @param   {Object} details - The object containing user details: name, username, password
 * @returns {Object} The object containing the user information: name, username
 * @throws  {Error} error creating account
 * @throws  {Error} invalid user object
 */
&nbsp;
exports.createUser = details =&gt; new Promise( (resolve, reject) =&gt; {
	if(!details.username || !details.password || !details.name){
		reject(new Error('invalid user object'))
	} else {
		new schema.User(details).save( (err, user) =&gt; {
			<span class="missing-if-branch" title="if path not taken" >I</span>if (err) {
<span class="cstat-no" title="statement not covered" >				reject(new Error('error creating account'))</span>
			}
			resolve({
				name: user.name,
				username: user.username
			})
		})
	}
})
&nbsp;
/**
 * Gets user information from database
 * @param   {string} username - The username used for filtering the data
 * @returns {Object} The object containing the user information: name, username, password
 * @throws  {Error} no user found
 * @throws  {Error} username must be provided
 */
&nbsp;
exports.getUser = username =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined) reject(new Error('username must be provided'))
	schema.User.find({username: username}, (err, user) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (user.length === 0) reject(new Error('no user found'))
		resolve(user[0])
	})
})
&nbsp;
/**
 * Deletes the user entry from database
 * @param   {string} username - The username used for filtering the data
 * @returns {string} A message to show that the deletion was successfull
 * @throws  {Error} ${username} cannot be deleted
 * @throws  {Error} username must be provided
 */
&nbsp;
exports.deleteUser = username =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined) reject(new Error('username must be provided'))
	schema.User.remove({ username: username}, (err, removed) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (removed.result.n === 0) reject(new Error(`${username} cannot be deleted`))
		resolve(`${username} deleted successfully`)
	})
})
&nbsp;
/**
 * Checks if the user exists in database
 * @param   {Object} user - The user account used for filtering the data. Must contain a username property
 * @returns {} nothing if the username doesn't exists
 * @throws  {Error} username must be provided
 * @throws  {Error} username must be provided
 */
&nbsp;
exports.checkUserExists = user =&gt; new Promise( (resolve, reject) =&gt; {
	if (user === undefined || user.username === undefined) reject(new Error('invalid user object'))
	schema.User.find({username: user.username}, (err, docs) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (docs.length) reject(new Error('username already exists'))
		resolve()
	})
})
&nbsp;
/**
 * Returns favourite restaurant for the provided ID
 * @param   {string} username - The username for which to search favourite list
 * @param   {string} id - Restaurant id to be retrieved from database
 * @returns {Object} Restaurant object
 * @throws  {Error} username/id must be provided
 * @throws  {Error} restaurant cannot be found in the favourites list
 */
&nbsp;
exports.getFavouriteById = (username, id) =&gt; new Promise( (resolve, reject) =&gt; {
	if(username === undefined || id === undefined) reject(new Error('username/id must be provided'))
	schema.Restaurant.find({id: id, username: username}, (err, docs) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (docs.length === 0) reject(new Error('restaurant cannot be found in the favourites list'))
		resolve(docs[0])
	})
})
&nbsp;
/**
 * Adds specified restaurant to the database for user favourites list
 * @param   {string} username - The username for which to search favourite list
 * @param   {Object} restaurant - The restaurant object to be saved
 * @returns {Object} Restaurant object
 * @throws  {Error} username/restaurant must be provided
 */
&nbsp;
exports.addToFavourites = (username, restaurant) =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined || restaurant === undefined) reject(new Error('username/restaurant must be provided'))
	restaurant.username = username
	restaurant.link = `/favourites/${restaurant.id}`
	new schema.Restaurant(restaurant).save( (err, restaurant) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
&nbsp;
		resolve(restaurant)
	})
})
&nbsp;
/**
 * Deletes specified restaurant from the database from user favourites list
 * @param   {string} username - The username for which to search favourite list
 * @param   {string} restaurantId - The restaurant ID to be deleted
 * @returns {Object} A message to show that the deletion was successfull
 * @throws  {Error} username/restaurantId must be provided
 * @throws  {Error} ${restaurantId} cannot be found in users favourites
 */
&nbsp;
exports.deleteFavourite = (username, restaurantId) =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined || restaurantId === undefined) reject(new Error('username/restaurantId must be provided'))
	schema.Restaurant.remove({id: restaurantId, username: username}, (err, removed) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (removed.result.n === 0) reject(new Error(`${restaurantId} cannot be found in users favourites`))
		resolve(`${restaurantId} has been deleted successfully`)
	})
})
&nbsp;
/**
 * Deletes all users favourites entries
 * @param   {string} username - The username for which to delete the favourites list
 * @returns {Object} Restaurant object
 * @throws  {Error} username/restaurant must be provided
 * @throws  {Error} ${username} does not have any favourites
 */
&nbsp;
exports.deleteFavourites = username =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined) reject(new Error('username must be provided'))
	schema.Restaurant.remove({username: username}, (err, removed) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (removed.result.n === 0) reject(new Error(`${username} does not have any favourites`))
		resolve(`${username} favourites have been deleted successfully`)
	})
})
&nbsp;
/**
 * Checks if the user favourite restaurant exists in database
 * @param   {string} username - The username used for filtering the data
 * @param   {string} restaurantId - The Restaurant ID which needs to be checked
 * @returns {} nothing if the restaurant doesn't exists
 * @throws  {Error} username/restaurantId must be provided
 * @throws  {Error} restaurant already exists in the favourites list
 */
&nbsp;
exports.checkFavouriteExists = (username, restaurantId) =&gt; new Promise( (resolve, reject) =&gt; {
	if(username === undefined || restaurantId === undefined) reject(new Error('username/restaurantId must be provided'))
	schema.Restaurant.find({id: restaurantId, username: username}, (err, docs) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (docs.length) reject(new Error('restaurant already exists in the favourites list'))
		resolve()
	})
})
&nbsp;
/**
 * Updates the comments for the user favourite restaurant provided
 * @param   {string} username - The username used for filtering the data
 * @param   {string} restaurantId - The Restaurant ID which needs to be updated
 * @param   {string} comments - The Rcomments which needs updated on the restaurant
 * @returns {Object} Restaurant object
 * @throws  {Error} username,comments and restaurantId must be provided
 * @throws  {Error} ${restaurantId} could not be found for user ${username} or the comment already exists
 */
&nbsp;
exports.updateFavourite = (username, restaurantId, comments) =&gt; new Promise( (resolve, reject) =&gt; {
	if(username === undefined || restaurantId === undefined || comments === undefined) reject(new Error('username,comments and restaurant ID must be provided'))
	schema.Restaurant.update({ username: username, id: restaurantId }, {comments: comments}, (err, doc) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (doc.nModified === 0) reject(new Error(`${restaurantId} could not be found for user ${username} or the comment already exists`))
		schema.Restaurant.find({username: username, id: restaurantId}, (err, restaurant) =&gt; {
			<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
			resolve(restaurant[0])
		})
	})
})
&nbsp;
/**
 * Gets all users favourites restaurants from database
 * @param   {string} username - The username used for filtering the data
 * @returns {Object} Result object containing total results and restaurants array
 * @throws  {Error} username must be provided
 * @throws  {Error} no favourites found for user ${username}
 */
&nbsp;
exports.getFavourites = username =&gt; new Promise( (resolve, reject) =&gt; {
	if (username === undefined) reject(new Error('username must be provided'))
	const favourites = {
		total: 0,
		restaurants: []
	}
&nbsp;
	schema.Restaurant.find({username: username}, (err, found) =&gt; {
		<span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >reject(err)</span>
		if (found.length === 0) resolve({ message: `no favourites found for user ${username}` })
&nbsp;
		found.forEach(element =&gt; {
			element.__v = undefined
			element._id = undefined
			element.username = undefined
			element.link = `/favourites/${element.id}`
		})
		favourites.total = found.length
		favourites.restaurants = found
&nbsp;
		resolve(favourites)
	})
})
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Dec 13 2016 17:57:50 GMT+0000 (GMT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
